"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{1346:function(t,e,r){r.d(e,{f1:function(){return es}});var n=r(1062);/**
 * @dice-roller/rpg-dice-roller - An advanced JS based dice roller that can roll various types of dice and modifiers, along with mathematical equations.
 * 
 * @version 5.5.0
 * @license MIT
 * @author GreenImp Media <info@greenimp.co.uk> (https://greenimp.co.uk)
 * @link https://dice-roller.github.io/documentation
 */class i extends TypeError{constructor(t){super(`Operator "${t}" is invalid`),TypeError.captureStackTrace&&TypeError.captureStackTrace(this,i),this.name="CompareOperatorError",this.operator=t}}class s extends Error{constructor(t){super(`Invalid data format: ${t}`),Error.captureStackTrace&&Error.captureStackTrace(this,s),this.name="ImportError",this.data=t}}class o extends Error{constructor(t,e=null){super(`Die "${t}" must have more than 1 possible value to ${e||"do this action"}`),Error.captureStackTrace&&Error.captureStackTrace(this,o),this.name="DieActionValueError",this.action=e,this.die=t}}class a extends Error{constructor(t){super(`Notation "${t}" is invalid`),Error.captureStackTrace&&Error.captureStackTrace(this,a),this.name="NotationError",this.notation=t}}class u extends Error{constructor(t=null){super(`Missing argument${t?` "${t}"`:""}`),Error.captureStackTrace&&Error.captureStackTrace(this,u),this.argumentName=t}}let l=(t,e,r)=>{let n;let i=Number(t),s=Number(e);if(Number.isNaN(i)||Number.isNaN(s))return!1;switch(r){case"=":case"==":n=i===s;break;case"<":n=i<s;break;case">":n=i>s;break;case"<=":n=i<=s;break;case">=":n=i>=s;break;case"!":case"!=":case"<>":n=i!==s;break;default:n=!1}return n},c=t=>(0,n.ku)(t),h=t=>("number"==typeof t||"string"==typeof t)&&!Number.isNaN(t)&&Number.isFinite(Number(t)),f=t=>{if(!h(t))return!1;let e=Number(t);return e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER},p=t=>Array.isArray(t)?t.reduce((t,e)=>t+(h(e)?parseFloat(`${e}`):0),0):0,m=(t,e=0)=>parseFloat(parseFloat(`${t}`).toFixed(e||0));function d(t){return 0|t.next()}function g(t,e){return 0===e?t:r=>t(r)+e}function y(t){let e=0|t.next();return(2097151&e)*4294967296+(t.next()>>>0)+(2097152&e?-9007199254740992:0)}function b(t){for(;;){let e=0|t.next();if(!(4194304&e))return(2097151&e)*4294967296+(t.next()>>>0)+(2097152&e?-9007199254740992:0);if((8388607&e)==4194304&&(0|t.next())==0)return 9007199254740992}}function x(t){return t.next()>>>0}function w(t){return(2097151&t.next())*4294967296+(t.next()>>>0)}function v(t){for(;;){let e=0|t.next();if(!(2097152&e))return(2097151&e)*4294967296+(t.next()>>>0);if((2097151&e)==0&&(0|t.next())==0)return 9007199254740992}}function S(t,e){return r=>{let n=0;do{let t=0|r.next();n=(2097151&t)*4294967296+(r.next()>>>0)+(2097152&t?-9007199254740992:0)}while(n<t||n>e);return n}}function A(t,e){if(t=Math.floor(t),e=Math.floor(e),t<-9007199254740992||!isFinite(t))throw RangeError("Expected min to be at least -9007199254740992");if(e>9007199254740992||!isFinite(e))throw RangeError("Expected max to be at most 9007199254740992");let r=e-t;if(r<=0||!isFinite(r))return()=>t;if(4294967295===r)return 0===t?x:g(d,t+2147483648);if(r<4294967295){var n;return g(((n=r)+1&n)!=0?function(t){let e=t+1,r=e*Math.floor(4294967296/e);return t=>{let n=0;do n=t.next()>>>0;while(n>=r);return n%e}}(n):t=>t.next()&n,t)}if(9007199254740991===r)return g(w,t);if(r<9007199254740991)return g(function(t){let e=t+1;if((0|e)==0){let t=(e/4294967296|0)-1;if((t+1&t)==0)return e=>(e.next()&t)*4294967296+(e.next()>>>0)}return function(t){let e=t*Math.floor(9007199254740992/t);return r=>{let n=0;do n=(2097151&r.next())*4294967296+(r.next()>>>0);while(n>=e);return n%t}}(e)}(r),t);if(e-1-t==9007199254740991)return g(v,t);if(-9007199254740992===t&&9007199254740992===e)return b;else if(-9007199254740992===t&&9007199254740991===e)return y;else if(-9007199254740991===t&&9007199254740992===e)return g(y,1);else if(9007199254740992===e)return g(S(t-1,e-1),1);else return S(t,e)}function E(t){return(1&t.next())==1}function N(t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_-"){let e=t.length;if(!e)throw Error("Expected pool not to be an empty string");let r=A(0,e-1);return(e,n)=>{let i="";for(let s=0;s<n;++s){let n=r(e);i+=t.charAt(n)}return i}}let T="0123456789abcdef",$=N(T),C=N(T.toUpperCase());function O(t,e){return t<0?Math.max(t+e,0):Math.min(t,e)}function R(t){let e=+t;return e<0?Math.ceil(e):Math.floor(e)}function I(t){return w(t)/9007199254740992}function F(t){return v(t)/9007199254740992}let j=Array.prototype.slice;function J(t,e,r=0){let n=e.length;if(n)for(let i=n-1>>>0;i>r;--i){let r=A(0,i)(t);if(i!==r){let t=e[i];e[i]=e[r],e[r]=t}}return e}let M=(()=>{try{if("xxx"==="x".repeat(3))return(t,e)=>t.repeat(e)}catch(t){}return(t,e)=>{let r="";for(;e>0;)1&e&&(r+=t),e>>=1,t+=t;return r}})();function P(t,e){return M("0",e-t.length)+t}let k={next:()=>4294967296*Math.random()|0};class q{constructor(t=k){this.engine=t}int32(){return d(this.engine)}uint32(){return x(this.engine)}uint53(){return w(this.engine)}uint53Full(){return v(this.engine)}int53(){return y(this.engine)}int53Full(){return b(this.engine)}integer(t,e){return A(t,e)(this.engine)}realZeroToOneInclusive(){return F(this.engine)}realZeroToOneExclusive(){return I(this.engine)}real(t,e,r=!1){return(function(t,e,r=!1){var n,i;if(isFinite(t)){if(!isFinite(e))throw RangeError("Expected max to be a finite number")}else throw RangeError("Expected min to be a finite number");return g((n=r?F:I,1==(i=e-t)?n:0===i?()=>0:t=>n(t)*i),t)})(t,e,r)(this.engine)}bool(t,e){var r,n,i;return(r=t,null==(n=e)?null==r?E:function(t){if(t<=0)return()=>!1;if(t>=1)return()=>!0;{var e,r;let n=4294967296*t;return n%1==0?(e=n-2147483648|0,t=>d(t)<e):(r=Math.round(9007199254740992*t),t=>w(t)<r)}}(r):r<=0?()=>!1:r>=n?()=>!0:(i=A(0,n-1),t=>i(t)<r))(this.engine)}pick(t,e,r){return function(t,e,r,n){let i=e.length;if(0===i)throw RangeError("Cannot pick from an empty array");let s=null==r?0:O(R(r),i),o=void 0===n?i:O(R(n),i);if(s>=o)throw RangeError(`Cannot pick between bounds ${s} and ${o}`);return e[A(s,o-1)(t)]}(this.engine,t,e,r)}shuffle(t){return J(this.engine,t)}sample(t,e){return function(t,e,r){if(r<0||r>e.length||!isFinite(r))throw RangeError("Expected sampleSize to be within 0 and the length of the population");if(0===r)return[];let n=j.call(e),i=n.length;if(i===r)return J(t,n,0);let s=i-r;return J(t,n,s-1).slice(s)}(this.engine,t,e)}die(t){return A(1,t)(this.engine)}dice(t,e){return(function(t,e){let r=A(1,t);return t=>{let n=[];for(let i=0;i<e;++i)n.push(r(t));return n}})(t,e)(this.engine)}uuid4(){return function(t){let e=t.next()>>>0,r=0|t.next(),n=0|t.next(),i=t.next()>>>0;return P(e.toString(16),8)+"-"+P((65535&r).toString(16),4)+"-"+P((r>>4&4095|16384).toString(16),4)+"-"+P((16383&n|32768).toString(16),4)+"-"+P((n>>4&65535).toString(16),4)+P(i.toString(16),8)}(this.engine)}string(t,e){return N(e)(this.engine,t)}hex(t,e){return(e?C:$)(this.engine,t)}date(t,e){return(function(t,e){let r=A(+t,+e);return t=>new Date(r(t))})(t,e)(this.engine)}}let V=(()=>{try{let t=new ArrayBuffer(4),e=new Int32Array(t);if(e[0]=2147483648,-2147483648===e[0])return Int32Array}catch(t){}return Array})(),D=(()=>{try{if(-5===Math.imul(4294967295,5))return Math.imul}catch(t){}return(t,e)=>{let r=65535&t,n=65535&e;return r*n+((t>>>16&65535)*n+r*(e>>>16&65535)<<16>>>0)|0}})();class _{constructor(){this.data=new V(624),this.index=0,this.uses=0}static seed(t){return new _().seed(t)}static seedWithArray(t){return new _().seedWithArray(t)}static autoSeed(){return _.seedWithArray(function(t=k,e=16){let r=[];r.push(0|new Date().getTime());for(let n=1;n<e;++n)r[n]=0|t.next();return r}())}next(){var t;(0|this.index)>=624&&(B(this.data),this.index=0);let e=this.data[this.index];return this.index=this.index+1|0,this.uses+=1,0|(t=e,t^=t>>>11,t^=t<<7&2636928640,(t^=t<<15&4022730752)^t>>>18)}getUseCount(){return this.uses}discard(t){if(t<=0)return this;for(this.uses+=t,(0|this.index)>=624&&(B(this.data),this.index=0);t+this.index>624;)t-=624-this.index,B(this.data),this.index=0;return this.index=this.index+t|0,this}seed(t){let e=0;this.data[0]=e=0|t;for(let t=1;t<624;t=t+1|0)this.data[t]=e=D(e^e>>>30,1812433253)+t|0;return this.index=624,this.uses=0,this}seedWithArray(t){return this.seed(19650218),function(t,e){let r=1,n=0,i=e.length,s=0|Math.max(i,624),o=0|t[0];for(;(0|s)>0;--s)t[r]=o=(t[r]^D(o^o>>>30,1664525))+(0|e[n])+(0|n)|0,r=r+1|0,++n,(0|r)>623&&(t[0]=t[623],r=1),n>=i&&(n=0);for(s=623;(0|s)>0;--s)t[r]=o=(t[r]^D(o^o>>>30,1566083941))-r|0,(0|(r=r+1|0))>623&&(t[0]=t[623],r=1);t[0]=2147483648}(this.data,t),this}}function B(t){let e=0,r=0;for(;(0|e)<227;e=e+1|0)r=2147483648&t[e]|2147483647&t[e+1|0],t[e]=t[e+397|0]^r>>>1^(1&r?2567483615:0);for(;(0|e)<623;e=e+1|0)r=2147483648&t[e]|2147483647&t[e+1|0],t[e]=t[e-227|0]^r>>>1^(1&r?2567483615:0);r=2147483648&t[623]|2147483647&t[0],t[623]=t[396]^r>>>1^(1&r?2567483615:0)}let L=Symbol("engine"),G=Symbol("random"),z={min:{next:()=>0},max:{range:[],next(){return this.range[1]-this.range[0]}}};class U{constructor(t=k){this.engine=t||k}get engine(){return this[L]}set engine(t){if(t&&"function"!=typeof t.next)throw TypeError("engine must have function `next()`");this[L]=t||k,this[G]=new q(this[L])}integer(t,e){return this[L].range=[t,e],this[G].integer(t,e)}real(t,e,r=!1){return this[L].range=[t,e],this[G].real(t,e,r)}}let W=new U,Z=Symbol("text"),X=Symbol("type");class H{static types={MULTILINE:"multiline",INLINE:"inline"};constructor(t,e=this.constructor.types.INLINE){this.text=t,this.type=e}get text(){return this[Z]}set text(t){if("object"==typeof t)throw TypeError("Description text is invalid");if(!t&&0!==t||""===`${t}`.trim())throw TypeError("Description text cannot be empty");this[Z]=`${t}`.trim()}get type(){return this[X]}set type(t){let e=Object.values(this.constructor.types);if("string"!=typeof t)throw TypeError("Description type must be a string");if(!e.includes(t))throw RangeError(`Description type must be one of; ${e.join(", ")}`);this[X]=t}toJSON(){let{text:t,type:e}=this;return{text:t,type:e}}toString(){return this.type===this.constructor.types.INLINE?`# ${this.text}`:`[${this.text}]`}}let K=Symbol("description");class Q{constructor(t=null){this.description=t}get description(){return this[K]||null}set description(t){if(t||0===t){if(t instanceof H)this[K]=t;else if("string"==typeof t)this[K]=new H(t);else throw TypeError(`description must be of type Description, string or null. Received ${typeof t}`)}else this[K]=null}toJSON(){let{description:t}=this;return{description:t}}toString(){return this.description?`${this.description}`:""}}class Y{static order=999;constructor(){this.order=this.constructor.order}get name(){return"modifier"}get notation(){return""}get maxIterations(){return 1e3}defaults(t){return{}}useDefaultsIfNeeded(t){Object.entries(this.defaults(t)).forEach(([t,e])=>{void 0===this[t]&&(this[t]=e)})}run(t,e){return this.useDefaultsIfNeeded(e),t}toJSON(){let{notation:t,name:e}=this;return{name:e,notation:t,type:"modifier"}}toString(){return this.notation}}let tt={compound:"!",explode:"!","critical-failure":"__","critical-success":"**",drop:"d",max:"v",min:"^",penetrate:"p","re-roll":"r","re-roll-once":"ro","target-failure":"_","target-success":"*",unique:"u","unique-once":"uo"},te=(...t)=>[...t].reduce((t,e)=>{let r;return t+(tt[r=e instanceof Y?e.name:e]||r)},""),tr=Symbol("calculation-value"),tn=Symbol("modifiers"),ti=Symbol("initial-value"),ts=Symbol("use-in-total"),to=Symbol("value");class ta{constructor(t,e=[],r=!0){if(h(t))this[ti]=Number(t),this.modifiers=e||[],this.useInTotal=r;else if(t&&"object"==typeof t&&!Array.isArray(t)){let n=h(t.initialValue)?t.initialValue:t.value;if(!h(n))throw TypeError(`Result value is invalid: ${n}`);this[ti]=Number(n),h(t.value)&&Number(t.value)!==this[ti]&&(this.value=t.value),h(t.calculationValue)&&parseFloat(`${t.calculationValue}`)!==this.value&&(this.calculationValue=t.calculationValue),this.modifiers=t.modifiers||e||[],this.useInTotal="boolean"==typeof t.useInTotal?t.useInTotal:r||!1}else if(t===1/0)throw RangeError("Result value must be a finite number");else throw TypeError(`Result value is invalid: ${t}`)}get calculationValue(){return h(this[tr])?parseFloat(this[tr]):this.value}set calculationValue(t){let e=h(t);if(t===1/0)throw RangeError("Result calculation value must be a finite number");if(t&&!e)throw TypeError(`Result calculation value is invalid: ${t}`);this[tr]=e?parseFloat(`${t}`):null}get initialValue(){return this[ti]}get modifierFlags(){return te(...this.modifiers)}get modifiers(){return this[tn]}set modifiers(t){if((Array.isArray(t)||t instanceof Set)&&[...t].every(t=>"string"==typeof t)){this[tn]=new Set([...t]);return}if(!t&&0!==t){this[tn]=new Set;return}throw TypeError(`modifiers must be a Set or array of modifier names: ${t}`)}get useInTotal(){return!!this[ts]}set useInTotal(t){this[ts]=!!t}get value(){return h(this[to])?this[to]:this[ti]}set value(t){if(t===1/0)throw RangeError("Result value must be a finite number");if(!h(t))throw TypeError(`Result value is invalid: ${t}`);this[to]=Number(t)}toJSON(){let{calculationValue:t,initialValue:e,modifierFlags:r,modifiers:n,useInTotal:i,value:s}=this;return{calculationValue:t,initialValue:e,modifierFlags:r,modifiers:[...n],type:"result",useInTotal:i,value:s}}toString(){return this.value+this.modifierFlags}}let tu=Symbol("rolls");class tl{constructor(t=[]){this.rolls=t}get length(){return this.rolls.length||0}get rolls(){return[...this[tu]]}set rolls(t){if(!t||!Array.isArray(t))throw TypeError(`rolls must be an array: ${t}`);this[tu]=[],t.forEach(t=>{this.addRoll(t)})}get value(){return this.rolls.reduce((t,e)=>t+(e.useInTotal?e.calculationValue:0),0)}addRoll(t){let e=t instanceof ta?t:new ta(t);this[tu].push(e)}toJSON(){let{rolls:t,value:e}=this;return{rolls:t,type:"roll-results",value:e}}toString(){return`[${this.rolls.join(", ")}]`}}let tc=Symbol("modifiers"),th=Symbol("qty"),tf=Symbol("sides"),tp=Symbol("min-value"),tm=Symbol("max-value");class td extends Q{constructor(t,e=1,r=null,n=1,i=null,s=null){if(super(s),t||0===t){if(t===1/0)throw RangeError("numerical sides must be finite number");if(h(t)){if(t<1||!f(t))throw RangeError("numerical sides must be a positive finite number")}else if("string"!=typeof t)throw TypeError("non-numerical sides must be a string")}else throw new u("sides");if(h(e)){if(e<1||e>999)throw RangeError("qty must be between 1 and 999")}else throw TypeError("qty must be a positive finite integer");let o=n;if(null==o)o=1;else if(h(o)){if(!f(o))throw RangeError("min must a finite number")}else throw TypeError("min must a finite number");if(i&&!h(i))throw TypeError("max must a finite number");if(i&&!f(i))throw RangeError("max must a finite number");this[th]=parseInt(`${e}`,10),this[tf]=t,r&&(this.modifiers=r),this[tp]=parseInt(o,10),this[tm]=i?parseInt(`${i}`,10):t}get average(){return(this.min+this.max)/2}get modifiers(){return this[tc]?new Map([...this[tc]].sort((t,e)=>t[1].order-e[1].order)):null}set modifiers(t){let e;if(t instanceof Map)e=t;else if(Array.isArray(t))e=new Map(t.map(t=>[t.name,t]));else if("object"==typeof t)e=new Map(Object.entries(t));else throw TypeError("modifiers should be a Map, array, or an Object containing Modifiers");if(e.size&&[...e.entries()].some(t=>!(t[1]instanceof Y)))throw TypeError("modifiers must only contain Modifier instances");this[tc]=e}get max(){return this[tm]}get min(){return this[tp]}get name(){return"standard"}get notation(){let t=`${this.qty}d${this.sides}`;return this.modifiers&&this.modifiers.size&&(t+=[...this.modifiers.values()].reduce((t,e)=>t+e.notation,"")),t}get qty(){return this[th]}get sides(){return this[tf]}roll(){let t=new tl;for(let e=0;e<this.qty;e++)t.addRoll(this.rollOnce());return(this.modifiers||[]).forEach(e=>{e.run(t,this)}),t}rollOnce(){return new ta(W.integer(this.min,this.max))}toJSON(){let{average:t,max:e,min:r,modifiers:n,name:i,notation:s,qty:o,sides:a}=this;return Object.assign(super.toJSON(),{average:t,max:e,min:r,modifiers:n,name:i,notation:s,qty:o,sides:a,type:"die"})}toString(){return`${this.notation}${this.description?` ${this.description}`:""}`}}class tg extends td{constructor(t=2,e=1,r=null,n=null){let i=t;if(i||0===i){if(1!==i&&2!==i)throw RangeError("nonBlanks must be 1 or 2")}else i=2;super(i,e,r,-1,1,n)}get name(){return"fudge"}get nonBlanks(){return super.sides}get sides(){return`F.${this.nonBlanks}`}rollOnce(){let t=0;if(2===this.nonBlanks)t=W.integer(1,3)-2;else if(1===this.nonBlanks){let e=W.integer(1,6);1===e?t=-1:6===e&&(t=1)}return new ta(t)}}class ty extends td{constructor(t=1,e=null,r=!1,n=null){super(100,t,e,null,null,n),this.sidesAsNumber=!!r}get name(){return"percentile"}get sides(){return this.sidesAsNumber?super.sides:"%"}}let tb=Symbol("operator"),tx=Symbol("value");class tw{constructor(t,e){if(t){if(!e&&0!==e)throw new u("value")}else throw new u("operator");this.operator=t,this.value=e}static isValidOperator(t){return"string"==typeof t&&/^(?:[<>!]?=|[<>]|<>)$/.test(t)}set operator(t){if(!this.constructor.isValidOperator(t))throw new i(t);this[tb]=t}get operator(){return this[tb]}set value(t){if(!h(t))throw TypeError("value must be a finite number");this[tx]=Number(t)}get value(){return this[tx]}isMatch(t){return l(t,this.value,this.operator)}toJSON(){let{operator:t,value:e}=this;return{operator:t,type:"compare-point",value:e}}toString(){return`${this.operator}${this.value}`}}let tv=Symbol("compare-point");class tS extends Y{constructor(t){super(),t&&(this.comparePoint=t)}get comparePoint(){return this[tv]}set comparePoint(t){if(!(t instanceof tw))throw TypeError("comparePoint must be instance of ComparePoint");this[tv]=t}get name(){return"comparison"}get notation(){return`${this.comparePoint||""}`}defaultComparePoint(t){return{}}defaults(t){let e=this.defaultComparePoint(t);return"object"==typeof e&&2===e.length?{comparePoint:new tw(...e)}:{}}isComparePoint(t){return!!this.comparePoint&&this.comparePoint.isMatch(t)}toJSON(){let{comparePoint:t}=this;return Object.assign(super.toJSON(),{comparePoint:t})}}class tA extends tS{static order=10;constructor(t){super(t)}get name(){return"critical-failure"}get notation(){return`cf${super.notation}`}defaultComparePoint(t){return["=",t.min]}run(t,e){return super.run(t,e),t.rolls.forEach(t=>(this.isComparePoint(t.value)&&t.modifiers.add("critical-failure"),t)),t}}class tE extends tS{static order=9;constructor(t){super(t)}get name(){return"critical-success"}get notation(){return`cs${super.notation}`}defaultComparePoint(t){return["=",t.max]}run(t,e){return super.run(t,e),t.rolls.forEach(t=>(this.isComparePoint(t.value)&&t.modifiers.add("critical-success"),t)),t}}let tN=Symbol("calculation-value"),tT=Symbol("is-roll-group"),t$=Symbol("modifiers"),tC=Symbol("results"),tO=Symbol("use-in-total");class tR{constructor(t=[],e=[],r=!1,n=!0){this.isRollGroup=r,this.modifiers=e,this.results=t,this.useInTotal=n}get calculationValue(){return h(this[tN])?parseFloat(this[tN]):this.value}set calculationValue(t){let e=h(t);if(t===1/0)throw RangeError("Results calculation value must be a finite number");if(t&&!e)throw TypeError(`Results calculation value is invalid: ${t}`);this[tN]=e?parseFloat(`${t}`):null}get isRollGroup(){return this[tT]}set isRollGroup(t){this[tT]=!!t}get length(){return this.results.length||0}get modifierFlags(){return te(...this.modifiers)}get modifiers(){return this[t$]}set modifiers(t){if((Array.isArray(t)||t instanceof Set)&&[...t].every(t=>"string"==typeof t))this[t$]=new Set([...t]);else if(t||0===t)throw TypeError(`modifiers must be a Set or array of modifier names: ${t}`);else this[t$]=new Set}get results(){return[...this[tC]]}set results(t){if(!t||!Array.isArray(t))throw TypeError(`results must be an array: ${t}`);this[tC]=[],t.forEach(t=>{this.addResult(t)})}get useInTotal(){return!!this[tO]}set useInTotal(t){this[tO]=!!t}get value(){if(!this.results.length)return 0;let t=this.results.reduce((t,e)=>{let r=e;return e instanceof tR?r=e.useInTotal?e.calculationValue:0:e instanceof tl&&(r=e.value),t+r},"string"==typeof this.results[0]?"":0);return"string"==typeof t?c(t):t}addResult(t){let e;if(t instanceof tR||t instanceof tl)e=t;else if("string"==typeof t||h(t))e=t;else throw TypeError("value must be one of ResultGroup, RollResults, string, or number");this[tC].push(e)}toJSON(){let{calculationValue:t,isRollGroup:e,modifierFlags:r,modifiers:n,results:i,useInTotal:s,value:o}=this;return{calculationValue:t,isRollGroup:e,modifierFlags:r,modifiers:[...n],results:i,type:"result-group",useInTotal:s,value:o}}toString(){let t;return t=this.isRollGroup?`{${this.results.join(", ")}}`:this.results.join(""),this.modifierFlags&&(t=`(${t})${this.modifierFlags}`),t}}let tI=Symbol("end"),tF=Symbol("qty");class tj extends Y{static order=6;constructor(t="h",e=1){super(),this.end=t,this.qty=e}get end(){return this[tI]}set end(t){if("h"!==t&&"l"!==t)throw RangeError('End must be "h" or "l"');this[tI]=t}get name(){return`keep-${this.end}`}get notation(){return`k${this.end}${this.qty}`}get qty(){return this[tF]}set qty(t){if(t===1/0)throw RangeError("qty must be a finite number");if(!h(t)||t<1)throw TypeError("qty must be a positive finite integer");this[tF]=Math.floor(t)}rangeToDrop(t){return"h"===this.end?[0,t.length-this.qty]:[this.qty,t.length]}run(t,e){let r,n;return(n=(n=t instanceof tR?1===(r=t.results).length&&r[0]instanceof tR?r[0].results.map((t,e)=>t instanceof tl?t.rolls.map((t,r)=>({value:t.value,index:[e,r]})):null).flat().filter(Boolean):[...r].map((t,e)=>({value:t.value,index:e})):[...r=t.rolls].map((t,e)=>({value:t.value,index:e}))).sort((t,e)=>t.value-e.value).map(t=>t.index).slice(...this.rangeToDrop(n))).forEach(t=>{let e;(e=Array.isArray(t)?r[0].results[t[0]].rolls[t[1]]:r[t]).modifiers.add("drop"),e.useInTotal=!1}),t}toJSON(){let{end:t,qty:e}=this;return Object.assign(super.toJSON(),{end:t,qty:e})}}class tJ extends tj{static order=7;constructor(t="l",e=1){super(t,e)}get name(){return`drop-${this.end}`}get notation(){return`d${this.end}${this.qty}`}rangeToDrop(t){return"h"===this.end?[t.length-this.qty,t.length]:[0,this.qty]}}let tM=Symbol("compound"),tP=Symbol("penetrate");class tk extends tS{static order=3;constructor(t=null,e=!1,r=!1){super(t),this[tM]=!!e,this[tP]=!!r}get compound(){return this[tM]}get name(){return"explode"}get notation(){return`!${this.compound?"!":""}${this.penetrate?"p":""}${super.notation}`}get penetrate(){return this[tP]}defaultComparePoint(t){return["=",t.max]}run(t,e){if(super.run(t,e),e.min===e.max)throw new o(e,"explode");return t.rolls=t.rolls.map(t=>{let r=[t],n=t.value;for(let t=0;t<this.maxIterations&&this.isComparePoint(n);t++){let t=r[r.length-1],i=e.rollOnce();n=i.value,t.modifiers.add("explode"),this.penetrate&&(t.modifiers.add("penetrate"),i.value-=1),r.push(i)}return this.compound&&r.length>1?(t.value=p(r.map(t=>t.value)),t.modifiers=["explode","compound"],this.penetrate&&t.modifiers.add("penetrate"),t):r}).flat(),t}toJSON(){let{compound:t,penetrate:e}=this;return Object.assign(super.toJSON(),{compound:t,penetrate:e})}}let tq=Symbol("max");class tV extends Y{static order=2;constructor(t){super(),this.max=t}get max(){return this[tq]}set max(t){if(!h(t))throw TypeError("max must be a number");this[tq]=parseFloat(`${t}`)}get name(){return"max"}get notation(){return`max${this.max}`}run(t,e){return t.rolls=t.rolls.map(t=>(t.value>this.max&&(t.value=this.max,t.modifiers.add("max")),t)),t}toJSON(){let{max:t}=this;return Object.assign(super.toJSON(),{max:t})}}let tD=Symbol("min");class t_ extends Y{static order=1;constructor(t){super(),this.min=t}get min(){return this[tD]}set min(t){if(!h(t))throw TypeError("min must be a number");this[tD]=parseFloat(`${t}`)}get name(){return"min"}get notation(){return`min${this.min}`}run(t,e){return t.rolls=t.rolls.map(t=>(t.value<this.min&&(t.value=this.min,t.modifiers.add("min")),t)),t}toJSON(){let{min:t}=this;return Object.assign(super.toJSON(),{min:t})}}let tB=Symbol("once");class tL extends tS{static order=4;constructor(t=!1,e=null){super(e),this.once=!!t}get name(){return"re-roll"}get notation(){return`r${this.once?"o":""}${super.notation}`}get once(){return!!this[tB]}set once(t){this[tB]=!!t}defaultComparePoint(t){return["=",t.min]}run(t,e){if(super.run(t,e),e.min===e.max)throw new o(e,"re-roll");return t.rolls.map(t=>{for(let r=0;r<this.maxIterations&&this.isComparePoint(t.value);r++){let r=e.rollOnce();if(t.value=r.value,t.modifiers.add(`re-roll${this.once?"-once":""}`),this.once)break}return t}),t}toJSON(){let{once:t}=this;return Object.assign(super.toJSON(),{once:t})}}let tG=Symbol("direction");class tz extends Y{static order=11;constructor(t="a"){super(),this.direction=t}get direction(){return this[tG]}set direction(t){if("a"!==t&&"d"!==t)throw RangeError('Direction must be "a" (Ascending) or "d" (Descending)');this[tG]=t}get name(){return"sorting"}get notation(){return`s${this.direction}`}run(t,e){let r;return r=t instanceof tR?"results":"rolls",t[r]=t[r].sort((t,e)=>"d"===this.direction?e.value-t.value:t.value-e.value),t instanceof tR&&(t[r]=t[r].map(t=>t instanceof tR||t instanceof tl?this.run(t,e):t)),t}toJSON(){let{direction:t}=this;return Object.assign(super.toJSON(),{direction:t})}}let tU=Symbol("failure-cp");class tW extends tS{static order=8;constructor(t,e=null){super(t),this.failureComparePoint=e}get failureComparePoint(){return this[tU]}set failureComparePoint(t){if(t&&!(t instanceof tw))throw TypeError("failure comparePoint must be instance of ComparePoint or null");this[tU]=t||null}get name(){return"target"}get notation(){return`${super.notation}${this.failureComparePoint?`f${this.failureComparePoint}`:""}`}get successComparePoint(){return this.comparePoint}set successComparePoint(t){super.comparePoint=t}getStateValue(t){return this.isSuccess(t)?1:this.isFailure(t)?-1:0}isFailure(t){return!!this.failureComparePoint&&this.failureComparePoint.isMatch(t)}isNeutral(t){return!this.isSuccess(t)&&!this.isFailure(t)}isSuccess(t){return this.isComparePoint(t)}run(t,e){return(t instanceof tR?t.results:t.rolls).forEach(t=>{this.isSuccess(t.value)?t.modifiers.add("target-success"):this.isFailure(t.value)&&t.modifiers.add("target-failure"),t.calculationValue=this.getStateValue(t.value)}),t}toJSON(){let{failureComparePoint:t,successComparePoint:e}=this,r=super.toJSON();return delete r.comparePoint,Object.assign(r,{failureComparePoint:t,successComparePoint:e})}}let tZ=Symbol("once"),tX=(t,e,r,n=!1)=>{let i=r.map(t=>t.value).indexOf(t.value);return n?i<e:i!==e};class tH extends tS{static order=5;constructor(t=!1,e=null){super(e),this.once=!!t}get name(){return"unique"}get notation(){return`u${this.once?"o":""}${super.notation}`}get once(){return!!this[tZ]}set once(t){this[tZ]=!!t}run(t,e){if(e.min===e.max)throw new o(e,"re-roll");return t.rolls.forEach((t,r,n)=>{if(0!==r)for(let i=0;i<this.maxIterations&&(!this.comparePoint||this.isComparePoint(t.value))&&tX(t,r,n,!0);i++){let r=e.rollOnce();if(t.value=r.value,t.modifiers.add(`unique${this.once?"-once":""}`),this.once)break}}),t}toJSON(){let{once:t}=this;return Object.assign(super.toJSON(),{once:t})}}let tK=t=>{try{return!!(t&&btoa(atob(t))===t)}catch(t){return!1}},tQ=t=>{try{let e=!!t&&JSON.parse(t);return!!(e&&"object"==typeof e)}catch(t){return!1}},tY=Symbol("expressions"),t0=Symbol("modifiers");class t1 extends Q{constructor(t=[],e=[],r=null){super(r),this.expressions=t,this.modifiers=e}get expressions(){return[...this[tY]||[]]}set expressions(t){if(!t)throw new u("expressions");if(!Array.isArray(t))throw TypeError(`expressions must be an array: ${t}`);this[tY]=[],t.forEach(e=>{if(!e||!Array.isArray(e))throw TypeError(`Expressions must be an array of arrays: ${t}`);if(0===e.length)throw TypeError(`Sub expressions cannot be empty: ${t}`);if(!e.every(t=>t instanceof td||"string"==typeof t||"number"==typeof t))throw TypeError("Sub expression items must be Dice, numbers, or strings");this[tY].push(e)})}get modifiers(){return this[t0]?new Map([...this[t0]].sort((t,e)=>t[1].order-e[1].order)):null}set modifiers(t){let e;if(t instanceof Map)e=t;else if(Array.isArray(t))e=new Map(t.map(t=>[t.name,t]));else if("object"==typeof t)e=new Map(Object.entries(t));else throw TypeError("modifiers should be a Map, array, or an Object containing Modifiers");if(e.size&&[...e.entries()].some(t=>!(t[1]instanceof Y)))throw TypeError("modifiers must only contain Modifier instances");this[t0]=e}get notation(){let t=this.expressions.map(t=>t.reduce((t,e)=>t+e,"")).join(", ");return t=`{${t}}`,this.modifiers&&this.modifiers.size&&(t+=[...this.modifiers.values()].reduce((t,e)=>t+e.notation,"")),t}roll(){let t=new tR(this.expressions.map(t=>new tR(t.map(t=>t instanceof td?t.roll():t))));return t.isRollGroup=!0,(this.modifiers||[]).forEach(e=>{e.run(t,this)}),t}toJSON(){let{modifiers:t,notation:e,expressions:r}=this;return Object.assign(super.toJSON(),{expressions:r,modifiers:t,notation:e,type:"group"})}toString(){return`${this.notation}${this.description?` ${this.description}`:""}`}}function t9(t,e,r,n){var i=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(i,t9.prototype),i.expected=e,i.found=r,i.location=n,i.name="SyntaxError",i}function t2(t,e,r){return(r=r||" ",t.length>e)?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t9,Error),t9.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<t.length;r++)if(t[r].source===this.location.source){n=t[r].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(i):i,o=this.location.source+":"+s.line+":"+s.column;if(n){var a=this.location.end,u=t2("",s.line.toString().length," "),l=n[i.line-1],c=(i.line===a.line?a.column:l.length+1)-i.column||1;e+="\n --> "+o+"\n"+u+" |\n"+s.line+" | "+l+"\n"+u+" | "+t2("",i.column-1," ")+t2("",c,"^")}else e+="\n at "+o}return e},t9.buildMessage=function(t,e){var r={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var e=t.parts.map(function(t){return Array.isArray(t)?s(t[0])+"-"+s(t[1]):s(t)});return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function o(t){return r[t.type](t)}return"Expected "+function(t){var e,r,n=t.map(o);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+(e?'"'+i(e)+'"':"end of input")+" found."};class t4{static parse(t){if(!t)throw new u("notation");if("string"!=typeof t)throw TypeError("Notation must be a string");return function(t,e){var r,n,i,s,o,a,u,l,h={},f=(e=void 0!==e?e:{}).grammarSource,p={Main:eo},m=eo,d="ceil",g="floor",y="round",b="sign",x="sqrt",w=/^[12]/,v=/^[lh]/,S=/^[.]/,A=/^[1-9]/,E=/^[0-9]/,N=/^[^\]]/,T=/^[\n\r\u2028\u2029]/,$=/^[ \t\n\r]/,C=ee("{",!1),O=ee(",",!1),R=ee("}",!1),I=ee("d",!1),F=ee("d%",!1),j=ee("dF",!1),J=ee(".",!1),M=er(["1","2"],!1,!1),P=ee("!",!1),k=ee("p",!1),q=er(["l","h"],!1,!1),V=ee("k",!1),D=ee("max",!1),_=ee("min",!1),B=ee("r",!1),L=ee("o",!1),G=ee("u",!1),z=ee("cs",!1),U=ee("cf",!1),W=ee("s",!1),Z=ee("a",!1),X=ee("f",!1),K=ee("!=",!1),Q=ee("<=",!1),Y=ee(">=",!1),tt=ee("=",!1),te=ee("<>",!1),tr=ee(">",!1),tn=ee("<",!1),ti=ee("(",!1),ts=ee(")",!1),to=ee("abs",!1),ta=ee("ceil",!1),tu=ee("cos",!1),tl=ee("exp",!1),tc=ee("floor",!1),th=ee("log",!1),tf=ee("round",!1),tp=ee("sign",!1),tm=ee("sin",!1),tb=ee("sqrt",!1),tx=ee("tan",!1),tv=ee("pow",!1),tS=ee("-",!1),tN=er(["."],!1,!1),tT=er([["1","9"]],!1,!1),t$=er([["0","9"]],!1,!1),tC=ee("**",!1),tO=ee("*",!1),tR=ee("^",!1),tI=ee("%",!1),tF=ee("/",!1),tM=ee("+",!1),tP=en("comment"),tq=ee("/*",!1),tD=ee("*/",!1),tB={type:"any"},tG=ee("[",!1),tU=er(["]"],!0,!1),tZ=ee("]",!1),tX=ee("//",!1),tK=ee("#",!1),tQ=er(["\n","\r","\u2028","\u2029"],!1,!1),tY=en("whitespace"),t0=er([" ","	","\n","\r"],!1,!1),t2=en("whitespace or comment"),t4=0,t7=0,t6=[{line:1,column:1}],t3=0,t5=[],t8=0;if("startRule"in e){if(!(e.startRule in p))throw Error("Can't start parsing from rule \""+e.startRule+'".');m=p[e.startRule]}function et(){return t.substring(t7,t4)}function ee(t,e){return{type:"literal",text:t,ignoreCase:e}}function er(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function en(t){return{type:"other",description:t}}function ei(e){var r,n=t6[e];if(n)return n;for(r=e-1;!t6[r];)r--;for(n={line:(n=t6[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return t6[e]=n,n}function es(t){t4<t3||(t4>t3&&(t3=t4,t5=[]),t5.push(t))}function eo(){return ec()}function ea(){var e,r,n,i,s,o,a,u,l,c,f,p,m,d,g,y,b,x,w,S,A,E,N,T,$,C,O,R,F,j,J,M,H,K,Q,Y,tt,te,tr,tn,ti,ts,to;return(r=t4,33===t.charCodeAt(t4)?(n="!",t4++):(n=h,0===t8&&es(P)),n!==h)?(33===t.charCodeAt(t4)?(i="!",t4++):(i=h,0===t8&&es(P)),i===h&&(i=null),112===t.charCodeAt(t4)?(s="p",t4++):(s=h,0===t8&&es(k)),s===h&&(s=null),(o=eu())===h&&(o=null),t7=r,r=new tk(o,!!i,!!s)):(t4=r,r=h),(e=r)===h&&((te=t4,(tr=eu())!==h)?((ti=t4,102===t.charCodeAt(t4)?(ts="f",t4++):(ts=h,0===t8&&es(X)),ts!==h&&(to=eu())!==h)?(t7=ti,ti=to):(t4=ti,ti=h),(tn=ti)===h&&(tn=null),t7=te,te=new tW(tr,tn)):(t4=te,te=h),(e=te)===h)&&((a=t4,100===t.charCodeAt(t4)?(u="d",t4++):(u=h,0===t8&&es(I)),u!==h&&(v.test(t.charAt(t4))?(l=t.charAt(t4),t4++):(l=h,0===t8&&es(q)),l===h&&(l=null),(c=ep())!==h))?(t7=a,a=new tJ(l||"l",c)):(t4=a,a=h),(e=a)===h&&((f=t4,107===t.charCodeAt(t4)?(p="k",t4++):(p=h,0===t8&&es(V)),p!==h&&(v.test(t.charAt(t4))?(m=t.charAt(t4),t4++):(m=h,0===t8&&es(q)),m===h&&(m=null),(d=ep())!==h))?(t7=f,f=new tj(m||"h",d)):(t4=f,f=h),(e=f)===h&&((g=t4,114===t.charCodeAt(t4)?(y="r",t4++):(y=h,0===t8&&es(B)),y!==h)?(111===t.charCodeAt(t4)?(b="o",t4++):(b=h,0===t8&&es(L)),b===h&&(b=null),(x=eu())===h&&(x=null),t7=g,g=new tL(!!b,x)):(t4=g,g=h),(e=g)===h&&((w=t4,117===t.charCodeAt(t4)?(S="u",t4++):(S=h,0===t8&&es(G)),S!==h)?(111===t.charCodeAt(t4)?(A="o",t4++):(A=h,0===t8&&es(L)),A===h&&(A=null),(E=eu())===h&&(E=null),t7=w,w=new tH(!!A,E)):(t4=w,w=h),(e=w)===h&&((N=t4,"cs"===t.substr(t4,2)?(T="cs",t4+=2):(T=h,0===t8&&es(z)),T!==h)?(($=eu())===h&&($=null),t7=N,N=new tE($)):(t4=N,N=h),(e=N)===h&&((C=t4,"cf"===t.substr(t4,2)?(O="cf",t4+=2):(O=h,0===t8&&es(U)),O!==h)?((R=eu())===h&&(R=null),t7=C,C=new tA(R)):(t4=C,C=h),(e=C)===h&&((F=t4,115===t.charCodeAt(t4)?(j="s",t4++):(j=h,0===t8&&es(W)),j!==h)?(97===t.charCodeAt(t4)?(J="a",t4++):(J=h,0===t8&&es(Z)),J===h&&(100===t.charCodeAt(t4)?(J="d",t4++):(J=h,0===t8&&es(I))),J===h&&(J=null),t7=F,F=new tz(J||"a")):(t4=F,F=h),(e=F)===h&&((M=t4,"max"===t.substr(t4,3)?(H="max",t4+=3):(H=h,0===t8&&es(D)),H!==h&&(K=ef())!==h)?(t7=M,M=new tV(K)):(t4=M,M=h),(e=M)===h))))))))&&((Q=t4,"min"===t.substr(t4,3)?(Y="min",t4+=3):(Y=h,0===t8&&es(_)),Y!==h&&(tt=ef())!==h)?(t7=Q,Q=new t_(tt)):(t4=Q,Q=h),e=Q),e}function eu(){var e,r,n,i;return(e=t4,"!="===t.substr(t4,2)?(i="!=",t4+=2):(i=h,0===t8&&es(K)),i===h&&("<="===t.substr(t4,2)?(i="<=",t4+=2):(i=h,0===t8&&es(Q)),i===h&&(">="===t.substr(t4,2)?(i=">=",t4+=2):(i=h,0===t8&&es(Y)),i===h&&(61===t.charCodeAt(t4)?(i="=",t4++):(i=h,0===t8&&es(tt)),i===h&&("<>"===t.substr(t4,2)?(i="<>",t4+=2):(i=h,0===t8&&es(te)),i===h&&(62===t.charCodeAt(t4)?(i=">",t4++):(i=h,0===t8&&es(tr)),i===h&&(60===t.charCodeAt(t4)?(i="<",t4++):(i=h,0===t8&&es(tn)))))))),(r=i)!==h&&(n=ef())!==h)?(t7=e,e=new tw(r,n)):(t4=e,e=h),e}function el(){var e,r,n,i,s,o,a,u,l,f;if((e=ep())===h){if(e=t4,40===t.charCodeAt(t4)?(r="(",t4++):(r=h,0===t8&&es(ti)),r!==h){if(ex(),n=t4,(i=ef())!==h){if(s=[],o=t4,a=ex(),(u=ed())!==h?(l=ex(),(f=ef())!==h?o=a=[a,u,l,f]:(t4=o,o=h)):(t4=o,o=h),o!==h)for(;o!==h;)s.push(o),o=t4,a=ex(),(u=ed())!==h?(l=ex(),(f=ef())!==h?o=a=[a,u,l,f]:(t4=o,o=h)):(t4=o,o=h);else s=h;s!==h?n=i=[i,s]:(t4=n,n=h)}else t4=n,n=h;n!==h&&(i=ex(),41===t.charCodeAt(t4)?(s=")",t4++):(s=h,0===t8&&es(ts)),s!==h)?(t7=e,e=c(et())):(t4=e,e=h)}else t4=e,e=h}return e}function ec(){var t,e,r,n,i,s,o,a,u;if(t=t4,(e=eh())!==h){for(r=[],n=t4,i=ex(),(s=ed())!==h?(o=ex(),(a=eh())!==h?n=i=[i,s,o,a]:(t4=n,n=h)):(t4=n,n=h);n!==h;)r.push(n),n=t4,i=ex(),(s=ed())!==h?(o=ex(),(a=eh())!==h?n=i=[i,s,o,a]:(t4=n,n=h)):(t4=n,n=h);t7=t,t=[...u=Array.isArray(u=e)?u:[u],...r.map(([,t,,e])=>[t,e]).flat(2)]}else t4=t,t=h;return t}function eh(){var e,r,n,i,s,o,a,u,l,c,f,p,m;return(s=t4,"abs"===t.substr(t4,3)?(o="abs",t4+=3):(o=h,0===t8&&es(to)),o===h&&(t.substr(t4,4)===d?(o=d,t4+=4):(o=h,0===t8&&es(ta)),o===h&&("cos"===t.substr(t4,3)?(o="cos",t4+=3):(o=h,0===t8&&es(tu)),o===h&&("exp"===t.substr(t4,3)?(o="exp",t4+=3):(o=h,0===t8&&es(tl)),o===h&&(t.substr(t4,5)===g?(o=g,t4+=5):(o=h,0===t8&&es(tc)),o===h&&("log"===t.substr(t4,3)?(o="log",t4+=3):(o=h,0===t8&&es(th)),o===h&&(t.substr(t4,5)===y?(o=y,t4+=5):(o=h,0===t8&&es(tf)),o===h&&(t.substr(t4,4)===b?(o=b,t4+=4):(o=h,0===t8&&es(tp)),o===h&&("sin"===t.substr(t4,3)?(o="sin",t4+=3):(o=h,0===t8&&es(tm)),o===h&&(t.substr(t4,4)===x?(o=x,t4+=4):(o=h,0===t8&&es(tb)),o===h&&("tan"===t.substr(t4,3)?(o="tan",t4+=3):(o=h,0===t8&&es(tx)))))))))))),o!==h&&(40===t.charCodeAt(t4)?(a="(",t4++):(a=h,0===t8&&es(ti)),a!==h&&(ex(),(u=ec())!==h&&(ex(),41===t.charCodeAt(t4)?(l=")",t4++):(l=h,0===t8&&es(ts)),l!==h))))?(t7=s,p=o,s=[`${p}(`,...u,")"]):(t4=s,s=h),s===h&&((s=t4,"pow"===t.substr(t4,3)?(o="pow",t4+=3):(o=h,0===t8&&es(tv)),o===h&&("max"===t.substr(t4,3)?(o="max",t4+=3):(o=h,0===t8&&es(D)),o===h&&("min"===t.substr(t4,3)?(o="min",t4+=3):(o=h,0===t8&&es(_)))),o!==h&&(40===t.charCodeAt(t4)?(a="(",t4++):(a=h,0===t8&&es(ti)),a!==h&&(ex(),(u=ec())!==h&&(ex(),44===t.charCodeAt(t4)?(l=",",t4++):(l=h,0===t8&&es(O)),l!==h&&(ex(),(c=ec())!==h&&(ex(),41===t.charCodeAt(t4)?(f=")",t4++):(f=h,0===t8&&es(ts)),f!==h))))))?(t7=s,m=o,s=[`${m}(`,...u,",",...c,")"]):(t4=s,s=h)),(e=s)===h&&(e=function(){var e,r,n,i,s,o,a,u,l,c,f,p,m,d,g,y,b,x,v,S,A;if(e=t4,(a=t4,(u=el())===h&&(u=null),100===t.charCodeAt(t4)?(l="d",t4++):(l=h,0===t8&&es(I)),l!==h&&(c=el())!==h)?(t7=a,a=new td(c,u||1)):(t4=a,a=h),(r=a)===h&&((f=t4,(p=el())===h&&(p=null),"d%"===t.substr(t4,2)?(m="d%",t4+=2):(m=h,0===t8&&es(F)),m!==h)?(t7=f,f=new ty(p||1)):(t4=f,f=h),(r=f)===h)&&((d=t4,(g=el())===h&&(g=null),"dF"===t.substr(t4,2)?(y="dF",t4+=2):(y=h,0===t8&&es(j)),y!==h)?(b=t4,46===t.charCodeAt(t4)?(x=".",t4++):(x=h,0===t8&&es(J)),x!==h?(w.test(t.charAt(t4))?(v=t.charAt(t4),t4++):(v=h,0===t8&&es(M)),v!==h?b=x=[x,v]:(t4=b,b=h)):(t4=b,b=h),b===h&&(b=null),t7=d,S=g,d=new tg((A=b)?parseInt(A[1],10):2,S||1)):(t4=d,d=h),r=d),r!==h){for(n=[],i=ea();i!==h;)n.push(i),i=ea();i=ew(),t7=e,s=r,o=i,s.modifiers=Object.assign({},...n.map(t=>({[t.name]:t}))),s.description=o.find(t=>t instanceof H),e=s}else t4=e,e=h;return e}())===h&&(e=ef())===h&&((e=t4,40===t.charCodeAt(t4)?(r="(",t4++):(r=h,0===t8&&es(ti)),r!==h&&(ex(),(n=ec())!==h&&(ex(),41===t.charCodeAt(t4)?(i=")",t4++):(i=h,0===t8&&es(ts)),i!==h)))?(t7=e,e=[r,...n,i]):(t4=e,e=h),e===h&&(e=function(){var e,r,n,i,s,o,a,u,l,c,f;if(e=t4,123===t.charCodeAt(t4)?(r="{",t4++):(r=h,0===t8&&es(C)),r!==h){if(ex(),(n=ec())!==h){for(i=[],s=t4,o=ex(),44===t.charCodeAt(t4)?(a=",",t4++):(a=h,0===t8&&es(O)),a!==h?(u=ex(),(l=ec())!==h?s=o=[o,a,u,l]:(t4=s,s=h)):(t4=s,s=h);s!==h;)i.push(s),s=t4,o=ex(),44===t.charCodeAt(t4)?(a=",",t4++):(a=h,0===t8&&es(O)),a!==h?(u=ex(),(l=ec())!==h?s=o=[o,a,u,l]:(t4=s,s=h)):(t4=s,s=h);if(s=ex(),125===t.charCodeAt(t4)?(o="}",t4++):(o=h,0===t8&&es(R)),o!==h){for(a=[],u=ea();u!==h;)a.push(u),u=ea();u=ew(),t7=e,c=a,f=u,e=new t1([n,...i.map(t=>t[3])],Object.assign({},...c.map(t=>({[t.name]:t}))),f.find(t=>t instanceof H))}else t4=e,e=h}else t4=e,e=h}else t4=e,e=h;return e}())),e}function ef(){var e,r,n,i;return e=t4,45===t.charCodeAt(t4)?t4++:0===t8&&es(tS),em()!==h?(r=t4,S.test(t.charAt(t4))?(n=t.charAt(t4),t4++):(n=h,0===t8&&es(tN)),n!==h&&(i=em())!==h?r=n=[n,i]:(t4=r,r=h),r===h&&(r=null),t7=e,e=parseFloat(et())):(t4=e,e=h),e}function ep(){var e,r,n,i;if(e=t4,A.test(t.charAt(t4))?(r=t.charAt(t4),t4++):(r=h,0===t8&&es(tT)),r!==h){for(n=[],E.test(t.charAt(t4))?(i=t.charAt(t4),t4++):(i=h,0===t8&&es(t$));i!==h;)n.push(i),E.test(t.charAt(t4))?(i=t.charAt(t4),t4++):(i=h,0===t8&&es(t$));t7=e,e=parseInt(et(),10)}else t4=e,e=h;return e}function em(){var e,r,n;if(e=t4,r=[],E.test(t.charAt(t4))?(n=t.charAt(t4),t4++):(n=h,0===t8&&es(t$)),n!==h)for(;n!==h;)r.push(n),E.test(t.charAt(t4))?(n=t.charAt(t4),t4++):(n=h,0===t8&&es(t$));else r=h;return r!==h&&(t7=e,r=parseInt(et(),10)),e=r}function ed(){var e,r;return e=t4,"**"===t.substr(t4,2)?(r="**",t4+=2):(r=h,0===t8&&es(tC)),r!==h&&(t7=e,r="^"),(e=r)===h&&(42===t.charCodeAt(t4)?(e="*",t4++):(e=h,0===t8&&es(tO)),e===h&&(94===t.charCodeAt(t4)?(e="^",t4++):(e=h,0===t8&&es(tR)),e===h&&(37===t.charCodeAt(t4)?(e="%",t4++):(e=h,0===t8&&es(tI)),e===h&&(47===t.charCodeAt(t4)?(e="/",t4++):(e=h,0===t8&&es(tF)),e===h&&(43===t.charCodeAt(t4)?(e="+",t4++):(e=h,0===t8&&es(tM)),e===h&&(45===t.charCodeAt(t4)?(e="-",t4++):(e=h,0===t8&&es(tS)))))))),e}function eg(){var e;return t8++,(e=function(){var e,r,n,i,s,o;if(e=t4,"/*"===t.substr(t4,2)?(r="/*",t4+=2):(r=h,0===t8&&es(tq)),r!==h){for(n=[],i=t4,s=t4,t8++,"*/"===t.substr(t4,2)?(o="*/",t4+=2):(o=h,0===t8&&es(tD)),t8--,o===h?s=void 0:(t4=s,s=h),s!==h?(t.length>t4?(o=t.charAt(t4),t4++):(o=h,0===t8&&es(tB)),o!==h?i=s=[s,o]:(t4=i,i=h)):(t4=i,i=h);i!==h;)n.push(i),i=t4,s=t4,t8++,"*/"===t.substr(t4,2)?(o="*/",t4+=2):(o=h,0===t8&&es(tD)),t8--,o===h?s=void 0:(t4=s,s=h),s!==h?(t.length>t4?(o=t.charAt(t4),t4++):(o=h,0===t8&&es(tB)),o!==h?i=s=[s,o]:(t4=i,i=h)):(t4=i,i=h);("*/"===t.substr(t4,2)?(i="*/",t4+=2):(i=h,0===t8&&es(tD)),i!==h)?(t7=e,e=new H(n.flat().join(""),H.types.MULTILINE)):(t4=e,e=h)}else t4=e,e=h;if(e===h){if(e=t4,91===t.charCodeAt(t4)?(r="[",t4++):(r=h,0===t8&&es(tG)),r!==h){for(n=[],N.test(t.charAt(t4))?(i=t.charAt(t4),t4++):(i=h,0===t8&&es(tU));i!==h;)n.push(i),N.test(t.charAt(t4))?(i=t.charAt(t4),t4++):(i=h,0===t8&&es(tU));(93===t.charCodeAt(t4)?(i="]",t4++):(i=h,0===t8&&es(tZ)),i!==h)?(t7=e,e=new H(n.flat().join(""),H.types.MULTILINE)):(t4=e,e=h)}else t4=e,e=h}return e}())===h&&(e=function(){var e,r,n,i,s,o;if(e=t4,"//"===t.substr(t4,2)?(r="//",t4+=2):(r=h,0===t8&&es(tX)),r===h&&(35===t.charCodeAt(t4)?(r="#",t4++):(r=h,0===t8&&es(tK))),r!==h){for(n=[],i=t4,s=t4,t8++,o=ey(),t8--,o===h?s=void 0:(t4=s,s=h),s!==h?(t.length>t4?(o=t.charAt(t4),t4++):(o=h,0===t8&&es(tB)),o!==h?i=s=[s,o]:(t4=i,i=h)):(t4=i,i=h);i!==h;)n.push(i),i=t4,s=t4,t8++,o=ey(),t8--,o===h?s=void 0:(t4=s,s=h),s!==h?(t.length>t4?(o=t.charAt(t4),t4++):(o=h,0===t8&&es(tB)),o!==h?i=s=[s,o]:(t4=i,i=h)):(t4=i,i=h);t7=e,e=new H(n.flat().join(""),H.types.INLINE)}else t4=e,e=h;return e}()),t8--,e===h&&0===t8&&es(tP),e}function ey(){var e;return T.test(t.charAt(t4))?(e=t.charAt(t4),t4++):(e=h,0===t8&&es(tQ)),e}function eb(){var e;return t8++,$.test(t.charAt(t4))?(e=t.charAt(t4),t4++):(e=h,0===t8&&es(t0)),t8--,e===h&&0===t8&&es(tY),e}function ex(){var t,e;for(t=[],e=eb();e!==h;)t.push(e),e=eb();return t}function ew(){var t,e;for(t8++,t=[],(e=eb())===h&&(e=eg());e!==h;)t.push(e),(e=eb())===h&&(e=eg());return t8--,e=h,0===t8&&es(t2),t}if((l=m())!==h&&t4===t.length)return l;throw l!==h&&t4<t.length&&es({type:"end"}),a=t5,u=t3<t.length?t.charAt(t3):null,r=t3,n=t3<t.length?t3+1:t3,i=ei(r),s=ei(n),o={source:f,start:{offset:r,line:i.line,column:i.column},end:{offset:n,line:s.line,column:s.column}},new t9(t9.buildMessage(a,u),a,u,o)}(t)}}let t7=Object.freeze({BASE_64:1,JSON:0,OBJECT:2}),t6=Symbol("notation"),t3=Symbol("maxTotal"),t5=Symbol("minTotal"),t8=Symbol("expressions"),et=Symbol("roll-method"),ee=Symbol("rolls"),er=Symbol("set-rolls"),en=Symbol("total"),ei=t=>m(t.calculationValue,2);class es{constructor(t){if(!t)throw new u("notation");if(this[t8]=[],t instanceof Object&&!Array.isArray(t)){if(t.notation){if("string"!=typeof t.notation)throw new a(t.notation);t.rolls&&this[er](t.rolls)}else throw new u("notation");this[t6]=t.notation,this[t8]=t4.parse(this.notation),this.hasRolls()||this.roll()}else if("string"==typeof t)this[t6]=t,this[t8]=t4.parse(this.notation),this.roll();else throw new a(t)}get averageTotal(){return(this.maxTotal+this.minTotal)/2}get maxTotal(){if(!this.hasExpressions())return 0;if(!this[t3]){let t=this[et](z.max);this[t3]=ei(t)}return this[t3]}get minTotal(){if(!this.hasExpressions())return 0;if(!this[t5]){let t=this[et](z.min);this[t5]=ei(t)}return this[t5]}get notation(){return this[t6]}get output(){let t=`${this.notation}: `;return this.hasRolls()?t+=`${this[ee]} = ${this.total}`:t+="No dice rolled",t}get rolls(){return this[ee]?this[ee].results:[]}get total(){return!this[en]&&this.hasRolls()&&(this[en]=ei(this[ee])),this[en]||0}export(t=t7.JSON){switch(t){case t7.BASE_64:return btoa(this.export(t7.JSON));case t7.JSON:return JSON.stringify(this);case t7.OBJECT:return JSON.parse(this.export(t7.JSON));default:throw TypeError(`Invalid export format "${t}"`)}}hasExpressions(){return this[t8]&&this[t8].length>0}hasRolls(){return this.hasExpressions()&&this.rolls.length>0}roll(){return this[en]=0,this[ee]=this[et](),this.rolls}toJSON(){let{averageTotal:t,maxTotal:e,minTotal:r,notation:n,output:i,rolls:s,total:o}=this;return{averageTotal:t,maxTotal:e,minTotal:r,notation:n,output:i,rolls:s,total:o,type:"dice-roll"}}toString(){return this.output}static import(t){if(t){if(tQ(t))return es.import(JSON.parse(t));if(tK(t))return es.import(atob(t));if("object"==typeof t)return new es(t);else throw new s(t)}throw new u("data")}[et](t){let e;t&&(e=W.engine,W.engine=t);let r=new tR(this[t8].map(t=>t instanceof td||t instanceof t1?t.roll():t).filter(t=>!!t||0===t));return t&&(W.engine=e),r}[er](t){if(t instanceof tR)this[ee]=t;else if(t instanceof tl)this[ee]=new tR([t]);else if(Array.isArray(t))this[ee]=new tR(t.map(t=>{if(t instanceof tR||t instanceof tl)return t;if(Array.isArray(t))return new tl(t);if("object"==typeof t){if(Array.isArray(t.results))return new tR(t.results,t.modifiers||[],t.isRollGroup||!1,"boolean"!=typeof t.useInTotal||t.useInTotal);if(Array.isArray(t.rolls))return new tl(t.rolls)}return t}));else throw TypeError("Rolls must be a valid result object, or an array")}}Symbol("log")}}]);